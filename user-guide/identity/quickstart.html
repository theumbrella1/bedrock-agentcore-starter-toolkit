
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    
      <meta name="description" content="Documentation for Amazon Bedrock AgentCore, primitives for building and running AI agents">
    
    
    
      <link rel="canonical" href="https://aws.github.io/bedrock-agentcore-starter-toolkit/user-guide/identity/quickstart.html">
    
    
      <link rel="prev" href="../memory/quickstart.html">
    
    
      <link rel="next" href="../builtin-tools/quickstart-browser.html">
    
    
    <link rel="icon" href="../.." sizes="any">
    <link rel="icon" href="../../assets/images/favicon.png" type="image/svg+xml">
    <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">

    
      
        <title>Identity Quickstart - Amazon Bedrock AgentCore</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.84d31ad4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        
        <link rel="stylesheet" href="../../assets/external/fonts.googleapis.com/css.49ea35f2.css">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#getting-started-with-agentcore-identity" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Amazon Bedrock AgentCore" class="md-header__button md-logo" aria-label="Amazon Bedrock AgentCore" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Amazon Bedrock AgentCore
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Identity Quickstart
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="custom" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/aws/bedrock-agentcore-starter-toolkit" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../index.html" class="md-tabs__link">
          
  
  
  User Guide

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../examples/index.html" class="md-tabs__link">
          
  
  
  Examples

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="https://github.com/aws/bedrock-agentcore-sdk-python/blob/main/CONTRIBUTING.md" class="md-tabs__link">
        
  
  
    
  
  Contribute ❤️

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../api-reference/runtime.html" class="md-tabs__link">
          
  
  
  API Reference

        </a>
      </li>
    
  

    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Amazon Bedrock AgentCore" class="md-nav__button md-logo" aria-label="Amazon Bedrock AgentCore" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Amazon Bedrock AgentCore
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/aws/bedrock-agentcore-starter-toolkit" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" checked>
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    User Guide
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            User Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Welcome
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_2" >
        
          
          <label class="md-nav__link" for="__nav_1_2" id="__nav_1_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Runtime
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_2">
            <span class="md-nav__icon md-icon"></span>
            Runtime
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../runtime/quickstart.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Runtime Quickstart
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../runtime/overview.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Runtime Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../runtime/permissions.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Runtime Permissions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../runtime/async.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Runtime Async Processing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../runtime/notebook.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Runtime Notebook
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_3" >
        
          
          <label class="md-nav__link" for="__nav_1_3" id="__nav_1_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Gateway
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_3">
            <span class="md-nav__icon md-icon"></span>
            Gateway
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../gateway/quickstart.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Gateway Quickstart
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_4" >
        
          
          <label class="md-nav__link" for="__nav_1_4" id="__nav_1_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Memory
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_4">
            <span class="md-nav__icon md-icon"></span>
            Memory
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../memory/quickstart.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Memory Quickstart
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_5" checked>
        
          
          <label class="md-nav__link" for="__nav_1_5" id="__nav_1_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Identity
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_1_5">
            <span class="md-nav__icon md-icon"></span>
            Identity
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Identity Quickstart
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="quickstart.html" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Identity Quickstart
    
  </span>
  

      </a>
      
        

  

<nav class="md-nav md-nav--secondary" aria-label="On this page">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      On this page
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    <span class="md-ellipsis">
      Prerequisites
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-the-sdk-and-dependencies" class="md-nav__link">
    <span class="md-ellipsis">
      Install the SDK and dependencies
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-05-create-a-cognito-user-pool" class="md-nav__link">
    <span class="md-ellipsis">
      Step 0.5: Create a Cognito user pool
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-1-create-a-credential-provider" class="md-nav__link">
    <span class="md-ellipsis">
      Step 1: Create a credential provider
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-2-create-a-sample-agent-that-initiates-an-oauth-20-flow" class="md-nav__link">
    <span class="md-ellipsis">
      Step 2: Create a sample agent that initiates an OAuth 2.0 flow
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 2: Create a sample agent that initiates an OAuth 2.0 flow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#agent-code" class="md-nav__link">
    <span class="md-ellipsis">
      Agent code
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-3-deploy-the-agent-to-agentcore-runtime" class="md-nav__link">
    <span class="md-ellipsis">
      Step 3: Deploy the agent to AgentCore Runtime
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 3: Deploy the agent to AgentCore Runtime">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#update-the-iam-policy-of-the-agent-to-be-able-to-access-the-token-vault-and-client-secret" class="md-nav__link">
    <span class="md-ellipsis">
      Update the IAM policy of the agent to be able to access the token vault, and client secret
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-4-invoke-the-agent" class="md-nav__link">
    <span class="md-ellipsis">
      Step 4: Invoke the agent!
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 4: Invoke the agent!">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#debugging" class="md-nav__link">
    <span class="md-ellipsis">
      Debugging
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clean-up" class="md-nav__link">
    <span class="md-ellipsis">
      Clean Up
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#security-best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      Security Best Practices
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_6" >
        
          
          <label class="md-nav__link" for="__nav_1_6" id="__nav_1_6_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Built-in Tools
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_6">
            <span class="md-nav__icon md-icon"></span>
            Built-in Tools
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../builtin-tools/quickstart-browser.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quickstart Browser Tool
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../builtin-tools/quickstart-code-interpreter.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quickstart Code Interpreter
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_7" >
        
          
          <label class="md-nav__link" for="__nav_1_7" id="__nav_1_7_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Observability
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_7">
            <span class="md-nav__icon md-icon"></span>
            Observability
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../observability/quickstart.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Observability Quickstart
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_8" >
        
          
          <label class="md-nav__link" for="__nav_1_8" id="__nav_1_8_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Import Agent
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_8">
            <span class="md-nav__icon md-icon"></span>
            Import Agent
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../import-agent/quickstart.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Import Agent Quickstart
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../import-agent/overview.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Import Agent Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../import-agent/configuration.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Import Agent Configuration
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/agentcore-quickstart-example.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Runtime Transform and Deploy Quickstart
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/session-management.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Session Management
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/async-processing.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Async Processing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/gateway-integration.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Gateway Integration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/memory_gateway_agent.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Memory Gateway Agent
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/runtime-framework-agents.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Runtime Framework Agents
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/semantic_search.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Semantic Search
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/aws/bedrock-agentcore-sdk-python/blob/main/CONTRIBUTING.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Contribute ❤️
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1" >
        
          
          <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Bedrock AgentCore SDK
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1">
            <span class="md-nav__icon md-icon"></span>
            Bedrock AgentCore SDK
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api-reference/runtime.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Runtime
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api-reference/identity.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Identity
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api-reference/memory.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Memory
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api-reference/tools.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Built-in Tools
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Bedrock AgentCore Starter Toolkit
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            Bedrock AgentCore Starter Toolkit
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api-reference/cli.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    AgentCore CLI
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  

<nav class="md-nav md-nav--secondary" aria-label="On this page">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      On this page
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    <span class="md-ellipsis">
      Prerequisites
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-the-sdk-and-dependencies" class="md-nav__link">
    <span class="md-ellipsis">
      Install the SDK and dependencies
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-05-create-a-cognito-user-pool" class="md-nav__link">
    <span class="md-ellipsis">
      Step 0.5: Create a Cognito user pool
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-1-create-a-credential-provider" class="md-nav__link">
    <span class="md-ellipsis">
      Step 1: Create a credential provider
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-2-create-a-sample-agent-that-initiates-an-oauth-20-flow" class="md-nav__link">
    <span class="md-ellipsis">
      Step 2: Create a sample agent that initiates an OAuth 2.0 flow
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 2: Create a sample agent that initiates an OAuth 2.0 flow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#agent-code" class="md-nav__link">
    <span class="md-ellipsis">
      Agent code
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-3-deploy-the-agent-to-agentcore-runtime" class="md-nav__link">
    <span class="md-ellipsis">
      Step 3: Deploy the agent to AgentCore Runtime
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 3: Deploy the agent to AgentCore Runtime">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#update-the-iam-policy-of-the-agent-to-be-able-to-access-the-token-vault-and-client-secret" class="md-nav__link">
    <span class="md-ellipsis">
      Update the IAM policy of the agent to be able to access the token vault, and client secret
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-4-invoke-the-agent" class="md-nav__link">
    <span class="md-ellipsis">
      Step 4: Invoke the agent!
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 4: Invoke the agent!">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#debugging" class="md-nav__link">
    <span class="md-ellipsis">
      Debugging
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clean-up" class="md-nav__link">
    <span class="md-ellipsis">
      Clean Up
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#security-best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      Security Best Practices
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="getting-started-with-agentcore-identity">Getting Started with AgentCore Identity<a class="headerlink" href="#getting-started-with-agentcore-identity" title="Permanent link">&para;</a></h1>
<p>Amazon Bedrock AgentCore Identity provides a secure way to manage identities for your AI agents and enable authenticated access to external services. This guide will help you get started with implementing identity features in your agent applications.</p>
<h2 id="prerequisites">Prerequisites<a class="headerlink" href="#prerequisites" title="Permanent link">&para;</a></h2>
<p>Before you begin, ensure you have:</p>
<ul>
<li>An AWS account with appropriate permissions</li>
<li>Python 3.10+ installed</li>
<li>The latest AWS CLI installed</li>
<li>AWS credentials and region configured (<code>aws configure</code>)</li>
</ul>
<p>This quickstart requires that you have an OAuth 2.0 authorization server. If you do not have one, Step 0.5 will create one for you using Amazon Cognito user pools. If you have an OAuth 2.0 authorization server with a client id, client secret, and a user configured, you may proceed to step 1. This authorization server will act as a resource credential provider, representing the authority that grants the agent an outbound OAuth 2.0 access token.</p>
<h2 id="install-the-sdk-and-dependencies">Install the SDK and dependencies<a class="headerlink" href="#install-the-sdk-and-dependencies" title="Permanent link">&para;</a></h2>
<p>Make a folder for this guide, create a Python virtual environment, and install the AgentCore SDK and the aws Python SDK (boto3)</p>
<div class="highlight"><pre><span></span><code>mkdir<span class="w"> </span>agentcore-identity-quickstart
<span class="nb">cd</span><span class="w"> </span>agentcore-identity-quickstart
python3<span class="w"> </span>-m<span class="w"> </span>venv<span class="w"> </span>.venv
<span class="nb">source</span><span class="w"> </span>.venv/bin/activate
pip<span class="w"> </span>install<span class="w"> </span>bedrock-agentcore<span class="w"> </span>boto3<span class="w"> </span>strands-agents<span class="w"> </span>bedrock-agentcore-starter-toolkit<span class="w"> </span>pyjwt
</code></pre></div>
<p>Also create the <code>requirements.txt</code> file with the following content. This will be used later by the AgentCore deployment tool.</p>
<div class="highlight"><pre><span></span><code>bedrock-agentcore
boto3
pyjwt
strands-agents
bedrock-agentcore-starter-toolkit
</code></pre></div>
<h2 id="step-05-create-a-cognito-user-pool">Step 0.5: Create a Cognito user pool<a class="headerlink" href="#step-05-create-a-cognito-user-pool" title="Permanent link">&para;</a></h2>
<p>This quickstart requires an OAuth 2.0 authorization server. If you do not have one available for testing, or if you want to keep your test separate from your authorization server, this script will use your AWS credentials to set up an Amazon Cognito instance for you to use as an authorization server. The script will create:</p>
<ul>
<li>A Cognito user pool</li>
<li>An OAuth 2.0 client, and client secret for that user pool</li>
<li>A test user and password in that Cognito user pool</li>
</ul>
<p>Deleting the Cognito user pool AgentCoreIdentityQuickStartPool will delete the associated client_id and user as well.</p>
<p>You may choose to save this script as create_cognito.sh and execute it from your command line, or paste the script into your command line.</p>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="nv">REGION</span><span class="o">=</span><span class="k">$(</span>aws<span class="w"> </span>configure<span class="w"> </span>get<span class="w"> </span>region<span class="k">)</span>

<span class="c1"># Create user pool</span>
<span class="nv">USER_POOL_ID</span><span class="o">=</span><span class="k">$(</span>aws<span class="w"> </span>cognito-idp<span class="w"> </span>create-user-pool<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--pool-name<span class="w"> </span>AgentCoreIdentityQuickStartPool<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--query<span class="w"> </span><span class="s1">&#39;UserPool.Id&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--no-cli-pager<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--output<span class="w"> </span>text<span class="k">)</span>

<span class="c1"># Create user pool domain</span>
<span class="nv">DOMAIN_NAME</span><span class="o">=</span><span class="s2">&quot;agentcore-quickstart-</span><span class="k">$(</span><span class="nv">LC_ALL</span><span class="o">=</span>C<span class="w"> </span>tr<span class="w"> </span>-dc<span class="w"> </span><span class="s1">&#39;a-z0-9&#39;</span><span class="w"> </span>&lt;<span class="w"> </span>/dev/urandom<span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-c<span class="w"> </span><span class="m">5</span><span class="k">)</span><span class="s2">&quot;</span>
aws<span class="w"> </span>cognito-idp<span class="w"> </span>create-user-pool-domain<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--domain<span class="w"> </span><span class="nv">$DOMAIN_NAME</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--no-cli-pager<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--user-pool-id<span class="w"> </span><span class="nv">$USER_POOL_ID</span><span class="w"> </span>&gt;<span class="w"> </span>/dev/null

<span class="c1"># Create user pool client with secret and hosted UI settings</span>
<span class="nv">CLIENT_RESPONSE</span><span class="o">=</span><span class="k">$(</span>aws<span class="w"> </span>cognito-idp<span class="w"> </span>create-user-pool-client<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--user-pool-id<span class="w"> </span><span class="nv">$USER_POOL_ID</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--client-name<span class="w"> </span>AgentCoreQuickStart<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--generate-secret<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--callback-urls<span class="w"> </span><span class="s2">&quot;https://bedrock-agentcore.</span><span class="nv">$REGION</span><span class="s2">.amazonaws.com/identities/oauth2/callback&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--allowed-o-auth-flows<span class="w"> </span><span class="s2">&quot;code&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--allowed-o-auth-scopes<span class="w"> </span><span class="s2">&quot;openid&quot;</span><span class="w"> </span><span class="s2">&quot;profile&quot;</span><span class="w"> </span><span class="s2">&quot;email&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--allowed-o-auth-flows-user-pool-client<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--supported-identity-providers<span class="w"> </span><span class="s2">&quot;COGNITO&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--query<span class="w"> </span><span class="s1">&#39;UserPoolClient.{ClientId:ClientId,ClientSecret:ClientSecret}&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--output<span class="w"> </span>json<span class="k">)</span>

<span class="nv">CLIENT_ID</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span><span class="w"> </span><span class="nv">$CLIENT_RESPONSE</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span>-r<span class="w"> </span><span class="s1">&#39;.ClientId&#39;</span><span class="k">)</span>
<span class="nv">CLIENT_SECRET</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span><span class="w"> </span><span class="nv">$CLIENT_RESPONSE</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span>-r<span class="w"> </span><span class="s1">&#39;.ClientSecret&#39;</span><span class="k">)</span>

<span class="c1"># Generate random username and password</span>
<span class="nv">USERNAME</span><span class="o">=</span><span class="s2">&quot;AgentCoreTestUser</span><span class="k">$(</span><span class="nb">printf</span><span class="w"> </span><span class="s2">&quot;%04d&quot;</span><span class="w"> </span><span class="k">$((</span><span class="nv">RANDOM</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="m">10000</span><span class="k">)))</span><span class="s2">&quot;</span>
<span class="nv">PASSWORD</span><span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span><span class="nv">LC_ALL</span><span class="o">=</span>C<span class="w"> </span>tr<span class="w"> </span>-dc<span class="w"> </span><span class="s1">&#39;A-Za-z0-9!@#$%^&amp;*()_+-=[]{}|;:,.&lt;&gt;?&#39;</span><span class="w"> </span>&lt;<span class="w"> </span>/dev/urandom<span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-c<span class="w"> </span><span class="m">16</span><span class="k">)</span><span class="s2">&quot;</span>

<span class="c1"># Create user with permanent password</span>
aws<span class="w"> </span>cognito-idp<span class="w"> </span>admin-create-user<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--user-pool-id<span class="w"> </span><span class="nv">$USER_POOL_ID</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--username<span class="w"> </span><span class="nv">$USERNAME</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--output<span class="w"> </span>text<span class="w"> </span>&gt;<span class="w"> </span>/dev/null

aws<span class="w"> </span>cognito-idp<span class="w"> </span>admin-set-user-password<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--user-pool-id<span class="w"> </span><span class="nv">$USER_POOL_ID</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--username<span class="w"> </span><span class="nv">$USERNAME</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--password<span class="w"> </span><span class="nv">$PASSWORD</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--output<span class="w"> </span>text<span class="w"> </span>&gt;<span class="w"> </span>/dev/null<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--permanent

<span class="c1"># Get region</span>

<span class="nv">ISSUER_URL</span><span class="o">=</span><span class="s2">&quot;https://cognito-idp.</span><span class="nv">$REGION</span><span class="s2">.amazonaws.com/</span><span class="nv">$USER_POOL_ID</span><span class="s2">/.well-known/openid-configuration&quot;</span>
<span class="nv">HOSTED_UI_URL</span><span class="o">=</span><span class="s2">&quot;https://</span><span class="nv">$DOMAIN_NAME</span><span class="s2">.auth.</span><span class="nv">$REGION</span><span class="s2">.amazoncognito.com&quot;</span>

<span class="c1"># Output results</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;User Pool ID: </span><span class="nv">$USER_POOL_ID</span><span class="s2">&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Client ID: </span><span class="nv">$CLIENT_ID</span><span class="s2">&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Client Secret: </span><span class="nv">$CLIENT_SECRET</span><span class="s2">&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Issuer URL: </span><span class="nv">$ISSUER_URL</span><span class="s2">&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Hosted UI URL: </span><span class="nv">$HOSTED_UI_URL</span><span class="s2">&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Test User: </span><span class="nv">$USERNAME</span><span class="s2">&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Test Password: </span><span class="nv">$PASSWORD</span><span class="s2">&quot;</span>

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;# Copy and paste these exports to set environment variables for later use:&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;export USER_POOL_ID=&#39;</span><span class="nv">$USER_POOL_ID</span><span class="s2">&#39;&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;export CLIENT_ID=&#39;</span><span class="nv">$CLIENT_ID</span><span class="s2">&#39;&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;export CLIENT_SECRET=&#39;</span><span class="nv">$CLIENT_SECRET</span><span class="s2">&#39;&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;export ISSUER_URL=&#39;</span><span class="nv">$ISSUER_URL</span><span class="s2">&#39;&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;export HOSTED_UI_URL=&#39;</span><span class="nv">$HOSTED_UI_URL</span><span class="s2">&#39;&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;export COGNITO_USERNAME=&#39;</span><span class="nv">$USERNAME</span><span class="s2">&#39;&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;export COGNITO_PASSWORD=&#39;</span><span class="nv">$PASSWORD</span><span class="s2">&#39;&quot;</span>
</code></pre></div>
<h2 id="step-1-create-a-credential-provider">Step 1: Create a credential provider<a class="headerlink" href="#step-1-create-a-credential-provider" title="Permanent link">&para;</a></h2>
<p>Credential providers are how your agent accesses external services. Create a credential provider and configure it with an OAuth 2.0 client for your authorization server.</p>
<p>If you are using your own authorization server, set the environment variables <code>ISSUER_URL</code>, <code>CLIENT_ID</code>, and <code>CLIENT_SECRET</code> with their appropriate values from your authorization server. If you are using the previous script to create an authorization server for you with Cognito, copy the EXPORT statements from the output into your terminal to set the environment variables.</p>
<p>This credential provider will be used by your agent's code to get access tokens to act on behalf of your user.</p>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="c1"># please note the expected ISSUER_URL format for Bedrock AgentCore is the full url, including .well-known/openid-configuration</span>
aws<span class="w"> </span>bedrock-agentcore-control<span class="w"> </span>create-oauth2-credential-provider<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--name<span class="w"> </span><span class="s2">&quot;AgentCoreIdentityQuickStartProvider&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--credential-provider-vendor<span class="w"> </span><span class="s2">&quot;CustomOauth2&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--no-cli-pager<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--oauth2-provider-config-input<span class="w"> </span><span class="s1">&#39;{</span>
<span class="s1">    &quot;customOauth2ProviderConfig&quot;: {</span>
<span class="s1">      &quot;oauthDiscovery&quot;: {</span>
<span class="s1">        &quot;discoveryUrl&quot;: &quot;&#39;</span><span class="nv">$ISSUER_URL</span><span class="s1">&#39;&quot;</span>
<span class="s1">      },</span>
<span class="s1">      &quot;clientId&quot;: &quot;&#39;</span><span class="nv">$CLIENT_ID</span><span class="s1">&#39;&quot;,</span>
<span class="s1">      &quot;clientSecret&quot;: &quot;&#39;</span><span class="nv">$CLIENT_SECRET</span><span class="s1">&#39;&quot;</span>
<span class="s1">    }</span>
<span class="s1">  }&#39;</span>
</code></pre></div>
<h2 id="step-2-create-a-sample-agent-that-initiates-an-oauth-20-flow">Step 2: Create a sample agent that initiates an OAuth 2.0 flow<a class="headerlink" href="#step-2-create-a-sample-agent-that-initiates-an-oauth-20-flow" title="Permanent link">&para;</a></h2>
<p>In this step, we will create an agent that initiates an OAuth 2.0 authorization flow to get tokens to act on behalf of the user. For simplicity, the agent will not make actual calls to external services on behalf of a user, but will prove to us that it has obtained consent to act on behalf of our test user.</p>
<h3 id="agent-code">Agent code<a class="headerlink" href="#agent-code" title="Permanent link">&para;</a></h3>
<p>Create a file named <code>agentcoreidentityquickstart.py</code>, and save this code.</p>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">AgentCore Identity Outbound Token Agent</span>

<span class="sd">This agent demonstrates the USER_FEDERATION OAuth 2.0 flow.</span>

<span class="sd">It handles the OAuth 2.0 user consent flow and inspects the resulting OAuth 2.0 access token.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">bedrock_agentcore.runtime</span><span class="w"> </span><span class="kn">import</span> <span class="n">BedrockAgentCoreApp</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">bedrock_agentcore.identity</span><span class="w"> </span><span class="kn">import</span> <span class="n">requires_access_token</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">jwt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">BedrockAgentCoreApp</span><span class="p">()</span>

<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">decode_jwt</span><span class="p">(</span><span class="n">token</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">decoded</span> <span class="o">=</span> <span class="n">jwt</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;verify_signature&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">})</span>
        <span class="k">return</span> <span class="n">decoded</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Error decoding JWT: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">}</span>

<span class="k">class</span><span class="w"> </span><span class="nc">StreamingQueue</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">finished</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">queue</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Queue</span><span class="p">()</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">put</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">finish</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">finished</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">stream</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">item</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">item</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">finished</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="k">yield</span> <span class="n">item</span>

<span class="n">queue</span> <span class="o">=</span> <span class="n">StreamingQueue</span><span class="p">()</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">handle_auth_url</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="k">await</span> <span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Authorization URL, please copy to your preferred browser: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="nd">@requires_access_token</span><span class="p">(</span>
    <span class="n">provider_name</span><span class="o">=</span><span class="s2">&quot;AgentCoreIdentityQuickStartProvider&quot;</span><span class="p">,</span>
    <span class="n">scopes</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;openid&quot;</span><span class="p">],</span>
    <span class="n">auth_flow</span><span class="o">=</span><span class="s2">&quot;USER_FEDERATION&quot;</span><span class="p">,</span>
    <span class="n">on_auth_url</span><span class="o">=</span><span class="n">handle_auth_url</span><span class="p">,</span> <span class="c1"># streams authorization URL to client</span>
    <span class="n">force_authentication</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">introspect_with_decorator</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">access_token</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Introspect token using decorator&quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Inside introspect_with_decorator - decorator succeeded&quot;</span><span class="p">)</span>
    <span class="k">await</span> <span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">({</span>
        <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Successfully received an access token to act on behalf of your user!&quot;</span><span class="p">,</span>
        <span class="s2">&quot;token_claims&quot;</span><span class="p">:</span> <span class="n">decode_jwt</span><span class="p">(</span><span class="n">access_token</span><span class="p">),</span>
        <span class="s2">&quot;token_length&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">access_token</span><span class="p">),</span>
        <span class="s2">&quot;token_preview&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">access_token</span><span class="p">[:</span><span class="mi">50</span><span class="p">]</span><span class="si">}</span><span class="s2">...</span><span class="si">{</span><span class="n">access_token</span><span class="p">[</span><span class="o">-</span><span class="mi">10</span><span class="p">:]</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">})</span>
    <span class="k">await</span> <span class="n">queue</span><span class="o">.</span><span class="n">finish</span><span class="p">()</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">entrypoint</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">agent_invocation</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Handler that uses only the decorator approach&quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Agent invocation started&quot;</span><span class="p">)</span>

    <span class="c1"># Start the agent task and immediately begin streaming</span>
    <span class="n">task</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">introspect_with_decorator</span><span class="p">())</span>

    <span class="c1"># Stream items as they come in</span>
    <span class="k">async</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">queue</span><span class="o">.</span><span class="n">stream</span><span class="p">():</span>
        <span class="k">yield</span> <span class="n">item</span>

    <span class="c1"># Wait for task completion</span>
    <span class="k">await</span> <span class="n">task</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</code></pre></div>
<h2 id="step-3-deploy-the-agent-to-agentcore-runtime">Step 3:  Deploy the agent to AgentCore Runtime<a class="headerlink" href="#step-3-deploy-the-agent-to-agentcore-runtime" title="Permanent link">&para;</a></h2>
<p>We will host this agent on AgentCore Runtime. We can do this easily with the AgentCore SDK we installed earlier.</p>
<p>From your terminal, run <code>agentcore configure -e agentcoreidentityquickstart.py</code> and <code>agentcore launch</code> . The deployment will work with the defaults set by <code>agentcore configure</code>, but you may customize them. Ensure that you select "No" for the <code>Configure OAuth authorizer instead</code> step. We want to use IAM authorization for this guide.</p>
<h3 id="update-the-iam-policy-of-the-agent-to-be-able-to-access-the-token-vault-and-client-secret">Update the IAM policy of the agent to be able to access the token vault, and client secret<a class="headerlink" href="#update-the-iam-policy-of-the-agent-to-be-able-to-access-the-token-vault-and-client-secret" title="Permanent link">&para;</a></h3>
<p>You will need to update the IAM policy of your agent that was created by or used with <code>agentcore configure</code>. This script will read your agent's configuration YAML and append the appropriate policy. You can copy and paste this script, or save it to a file and execute it.</p>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1"># Parse values from .bedrock_agentcore.yaml</span>
<span class="nv">EXECUTION_ROLE</span><span class="o">=</span><span class="k">$(</span>grep<span class="w"> </span><span class="s2">&quot;execution_role:&quot;</span><span class="w"> </span>.bedrock_agentcore.yaml<span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-1<span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{print $2}&#39;</span><span class="k">)</span>
<span class="nv">AWS_ACCOUNT</span><span class="o">=</span><span class="k">$(</span>grep<span class="w"> </span><span class="s2">&quot;account:&quot;</span><span class="w"> </span>.bedrock_agentcore.yaml<span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-1<span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{print $2}&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tr<span class="w"> </span>-d<span class="w"> </span><span class="s2">&quot;&#39;&quot;</span><span class="k">)</span>
<span class="nv">REGION</span><span class="o">=</span><span class="k">$(</span>grep<span class="w"> </span><span class="s2">&quot;region:&quot;</span><span class="w"> </span>.bedrock_agentcore.yaml<span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{print $2}&#39;</span><span class="k">)</span>

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Parsed values:&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Execution Role: </span><span class="nv">$EXECUTION_ROLE</span><span class="s2">&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Account: </span><span class="nv">$AWS_ACCOUNT</span><span class="s2">&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Region: </span><span class="nv">$REGION</span><span class="s2">&quot;</span>

<span class="c1"># Create the policy document with proper variable substitution</span>
cat<span class="w"> </span>&gt;<span class="w"> </span>agentcore-identity-policy.json<span class="w"> </span><span class="s">&lt;&lt; EOF</span>
<span class="s">{</span>
<span class="s">  &quot;Version&quot;: &quot;2012-10-17&quot;,</span>
<span class="s">  &quot;Statement&quot;: [</span>
<span class="s">    {</span>
<span class="s">      &quot;Sid&quot;: &quot;AccessTokenVault&quot;,</span>
<span class="s">      &quot;Effect&quot;: &quot;Allow&quot;,</span>
<span class="s">      &quot;Action&quot;: [</span>
<span class="s">        &quot;bedrock-agentcore:GetResourceOauth2Token&quot;,</span>
<span class="s">        &quot;secretsmanager:GetSecretValue&quot;</span>
<span class="s">      ],</span>
<span class="s">      &quot;Resource&quot;: [&quot;arn:aws:bedrock-agentcore:${REGION}:${AWS_ACCOUNT}:workload-identity-directory/default/workload-identity/*&quot;,</span>
<span class="s">        &quot;arn:aws:bedrock-agentcore:${REGION}:${AWS_ACCOUNT}:token-vault/default/oauth2credentialprovider/AgentCoreIdentityQuickStartProvider&quot;,</span>
<span class="s">        &quot;arn:aws:bedrock-agentcore:${REGION}:${AWS_ACCOUNT}:workload-identity-directory/default&quot;,</span>
<span class="s">        &quot;arn:aws:bedrock-agentcore:${REGION}:${AWS_ACCOUNT}:token-vault/default&quot;,</span>
<span class="s">        &quot;arn:aws:secretsmanager:${REGION}:${AWS_ACCOUNT}:secret:bedrock-agentcore-identity!default/oauth2/AgentCoreIdentityQuickStartProvider*&quot;</span>
<span class="s">      ]</span>
<span class="s">    }</span>
<span class="s">  ]</span>
<span class="s">}</span>
<span class="s">EOF</span>

<span class="c1"># Create the policy</span>
<span class="nv">POLICY_ARN</span><span class="o">=</span><span class="k">$(</span>aws<span class="w"> </span>iam<span class="w"> </span>create-policy<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--policy-name<span class="w"> </span>AgentCoreIdentityQuickStartPolicy<span class="k">$(</span><span class="nv">LC_ALL</span><span class="o">=</span>C<span class="w"> </span>tr<span class="w"> </span>-dc<span class="w"> </span><span class="s1">&#39;0-9&#39;</span><span class="w"> </span>&lt;<span class="w"> </span>/dev/urandom<span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-c<span class="w"> </span><span class="m">4</span><span class="k">)</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--policy-document<span class="w"> </span>file://agentcore-identity-policy.json<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--query<span class="w"> </span><span class="s1">&#39;Policy.Arn&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--output<span class="w"> </span>text<span class="k">)</span>

<span class="c1"># Extract role name from ARN and attach policy</span>
<span class="nv">ROLE_NAME</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span><span class="w"> </span><span class="nv">$EXECUTION_ROLE</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span>-F<span class="s1">&#39;/&#39;</span><span class="w"> </span><span class="s1">&#39;{print $NF}&#39;</span><span class="k">)</span>
aws<span class="w"> </span>iam<span class="w"> </span>attach-role-policy<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--role-name<span class="w"> </span><span class="nv">$ROLE_NAME</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--policy-arn<span class="w"> </span><span class="nv">$POLICY_ARN</span>

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Policy created and attached: </span><span class="nv">$POLICY_ARN</span><span class="s2">&quot;</span>

<span class="c1"># Cleanup</span>
rm<span class="w"> </span>agentcore-identity-policy.json
</code></pre></div>
<h2 id="step-4-invoke-the-agent">Step 4: Invoke the agent!<a class="headerlink" href="#step-4-invoke-the-agent" title="Permanent link">&para;</a></h2>
<p>Now that this is all set up, you can invoke the agent. For this demo, we will use the <code>agentcore invoke</code> command and our IAM credentials. We will need to pass the <code>--user-id</code> and <code>--session-id</code> arguments when using IAM authentication.</p>
<p><code>agentcore invoke "TestPayload" --agent agentcoreidentityquickstart --user-id "SampleUserID" --session-id "ALongThirtyThreeCharacterMinimumSessionIdYouCanChangeThisAsYouNeed"</code></p>
<p>The agent will then return a URL to your <code>agentcore invoke</code> command. Copy and paste that URL into your preferred browser, and you will then be redirected to your authorization server's login page. The <code>--user-id</code> parameter is the user ID you are presenting to AgentCore Identity. The <code>--session-id</code> parameter is the session ID, which must be at least 33 characters long.</p>
<p>Enter the username and password for your user on your authorization server when prompted on your browser, or use your preferred authentication method you have configured. If you used the script from Step 0.5 to create a Cognito instance, you can retrieve this from your terminal history.</p>
<p>Your browser should redirect you to the AgentCore Identity Success Page, and you should have a success message in your terminal</p>
<p>Note that if you interrupt an invocation without completing authorization, you may need to request a new URL using a new session ID (<code>--session-id</code> parameter).</p>
<h3 id="debugging">Debugging<a class="headerlink" href="#debugging" title="Permanent link">&para;</a></h3>
<p>Should you encounter any errors or unexpected behaviors, the output of the agent is captured in CloudWatch logs. A log tailing command is provided after you run <code>agentcore launch</code></p>
<h2 id="clean-up">Clean Up<a class="headerlink" href="#clean-up" title="Permanent link">&para;</a></h2>
<p>After you're done, you can delete the Cognito user pool, Amazon ECR repo, CodeBuild Project, IAM roles for the agent and CodeBuild project, and finally delete the agent, and credential provider.</p>
<h2 id="security-best-practices">Security Best Practices<a class="headerlink" href="#security-best-practices" title="Permanent link">&para;</a></h2>
<p>When working with identity information:</p>
<ol>
<li><strong>Never hardcode credentials</strong> in your agent code</li>
<li><strong>Use environment variables or AWS Secrets Manager</strong> for sensitive information</li>
<li><strong>Apply least privilege principle</strong> when configuring IAM permissions</li>
<li><strong>Regularly rotate credentials</strong> for external services</li>
<li><strong>Audit access logs</strong> to monitor agent activity</li>
<li><strong>Implement proper error handling</strong> for authentication failures</li>
</ol>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
    <a href="" target="_blank" rel="noopener" title="" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.copy", "content.code.select", "navigation.instant", "navigation.instant.prefetch", "navigation.instant.progress", "navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.top", "search.highlight", "content.code.copy"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
        <script src="../../assets/external/unpkg.com/mermaid@11/dist/mermaid.min.js"></script>
      
    
  </body>
</html>